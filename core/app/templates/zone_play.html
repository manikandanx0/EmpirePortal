{% extends "base.html" %}

{% block title %}
  {{ zone.title }} â€“ Zone | ðŸ‘‘ Tech Empire Quest
{% endblock %}

{% block content %}
<section class="max-w-5xl mx-auto space-y-8 relative">

  <!-- ZONE TIMER (TOP LEFT HUD) -->
  <div
    id="zone-timer"
    role="status"
    aria-live="polite"
    aria-atomic="true"
    class="
      fixed top-4 left-4 z-40
      panel
      mono
      px-5 py-2
      text-sm
      tracking-widest
      select-none
    "
  >
    Time spent: 0:00
  </div>

  <!-- ZONE HEADER -->
  <div class="panel card hud space-y-2">
    <h2 id="zone-title" class="text-2xl tracking-widest text-[var(--neon-cyan)]">
      {{ zone.title }}
    </h2>

    <p class="mono text-sm text-[var(--text-muted)] tracking-wider">
      <span class="text-[var(--text-main)]">{{ player.name }}</span>
      <span class="opacity-60"> ({{ role }})</span>
    </p>
  </div>

  <!-- ZONE CONTENT CARD -->
  <div
    role="region"
    aria-labelledby="zone-title"
    class="panel card hud prose prose-invert max-w-none"
  >
    {{ content|safe }}
  </div>

  <!-- SUBMIT PANEL -->
  <form
    method="post"
    action="{% url 'submit_zone' zone.id %}"
    class="panel card hud flex items-center justify-end"
  >
    {% csrf_token %}
    <button type="submit" class="btn mono">
      Submit Zone
    </button>
  </form>

</section>

<script>
(() => {
  // ZONE TIMER (isolated scope)
  const zoneTimerEl = document.getElementById("zone-timer");
  if (!zoneTimerEl) return;

  const zoneStartTime = new Date("{{ attempt.entry_time|date:'c' }}").getTime();

  function updateZoneTimer() {
    const now = Date.now();
    const diff = Math.floor((now - zoneStartTime) / 1000);

    const mins = Math.floor(diff / 60);
    const secs = diff % 60;

    zoneTimerEl.textContent =
      "Time spent: " + mins + ":" + String(secs).padStart(2, "0");

    // Optional urgency styling
    if (diff > 300) {
      zoneTimerEl.classList.add("border-[var(--neon-pink)]");
    }
  }

  updateZoneTimer();
  setInterval(updateZoneTimer, 1000);
})();
</script>

{% endblock %}
