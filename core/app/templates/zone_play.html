{% extends "base.html" %}

{% block title %}
  {{ zone.title }} â€“ Zone
{% endblock %}

{% block content %}

<!-- ZONE TIMER (TOP LEFT) -->
<div
  id="zone-timer"
  role="status"
  aria-live="polite"
  aria-atomic="true"
>
  Time spent: 0:00
</div>

<!-- ZONE HEADER -->
<h2 id="zone-title">
  {{ zone.title }}
</h2>

<p>
  <span>{{ player.name }}</span> ({{ role }})
</p>

<hr>

<!-- ZONE CONTENT CARD -->
<div
  role="region"
  aria-labelledby="zone-title"
>
  {{ content|safe }}
</div>

<!-- SUBMIT -->
<form
  method="post"
  action="{% url 'submit_zone' zone.id %}"
>
  {% csrf_token %}
  <button
    type="submit"
  >
    Submit Zone
  </button>
</form>

<script>
(() => {
  // --- ZONE TIMER (isolated scope, no collision with global timer) ---
  const zoneStartTime = new Date("{{ attempt.entry_time|date:'c' }}").getTime()
  const zoneTimerEl = document.getElementById("zone-timer")
  if (!zoneTimerEl) return

  function updateZoneTimer() {
    const now = Date.now()
    const diff = Math.floor((now - zoneStartTime) / 1000)

    const mins = Math.floor(diff / 60)
    const secs = diff % 60

    zoneTimerEl.textContent =
      `Time spent: ${mins}:${String(secs).padStart(2, "0")}`

    // Optional: urgency after 5 mins
    if (diff > 300) {
      zoneTimerEl.classList.add("bg-[var(--yellow-500)]")
    }
  }

  updateZoneTimer()
  setInterval(updateZoneTimer, 1000)
})()
</script>
{% endblock %}
