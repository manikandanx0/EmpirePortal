{% extends "base.html" %}

{% block title %}
  {{ zone.title }} â€“ Zone
{% endblock %}

{% block content %}

<!-- ZONE TIMER (TOP LEFT) -->
<div
  id="zone-timer"
  class="
    fixed
    top-4
    left-4
    z-50
    bg-[var(--panel-bg)]
    border-2
    border-[var(--ink-black)]
    px-4
    py-2
    font-mono
    text-lg
    font-bold
    shadow-[3px_3px_0_rgba(28,28,28,0.6)]
    select-none
  "
>
  Time spent: 0:00
</div>

<!-- ZONE HEADER -->
<h2 class="text-4xl font-extrabold text-center mb-2 tracking-wide">
  {{ zone.title }}
</h2>

<p class="text-center text-lg mb-8">
  <span class="font-semibold">{{ player.name }}</span> ({{ role }})
</p>

<hr class="border-[var(--ink-black)] mb-10">

<!-- ZONE CONTENT CARD -->
<div
  class="
    zone-content
    max-w-4xl
    mx-auto
    bg-[var(--panel-bg)]
    p-8
    border-2
    border-[var(--ink-black)]
    shadow-[4px_4px_0_rgba(28,28,28,0.6)]
    text-lg
    leading-relaxed
  "
>
  {{ content|safe }}
</div>

<!-- SUBMIT -->
<form
  method="post"
  action="{% url 'submit_zone' zone.id %}"
  class="flex justify-center mt-12"
>
  {% csrf_token %}
  <button
    type="submit"
    class="
      px-10
      py-4
      text-xl
      font-extrabold
      tracking-wide
      border-2
      border-[var(--ink-black)]
      bg-[var(--green-500)]
      hover:-translate-x-1
      hover:-translate-y-1
      transition
    "
  >
    Submit Zone
  </button>
</form>

<script>
(() => {
  // --- ZONE TIMER (isolated scope, no collision with global timer) ---
  const zoneStartTime = new Date("{{ attempt.entry_time|date:'c' }}").getTime()
  const zoneTimerEl = document.getElementById("zone-timer")
  if (!zoneTimerEl) return

  function updateZoneTimer() {
    const now = Date.now()
    const diff = Math.floor((now - zoneStartTime) / 1000)

    const mins = Math.floor(diff / 60)
    const secs = diff % 60

    zoneTimerEl.textContent =
      `Time spent: ${mins}:${String(secs).padStart(2, "0")}`

    // Optional: urgency after 5 mins
    if (diff > 300) {
      zoneTimerEl.classList.add("bg-[var(--yellow-500)]")
    }
  }

  updateZoneTimer()
  setInterval(updateZoneTimer, 1000)
})()
</script>
{% endblock %}
